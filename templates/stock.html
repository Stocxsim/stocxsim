<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Interface</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
    <link rel="stylesheet" href="/static/css/stock.css">
</head>

<body data-stock-token="{{ stock.stock_token }}">

    <div id="stockPage"
         data-stock-token="{{ stock.stock_token }}"
         data-stock-name="{{ stock.stock_name }}"
         data-ema20="{{ stock.ema_20 if stock.ema_20 else 0 }}"
            data-rsi="{{ stock.rsi if stock.rsi else 50 }}"
            data-holding-qty="{{ holding.quantity if holding else 0 }}"
            data-holding-avg="{{ holding.avg_buy_price if holding else 0 }}"
         style="display:none"></div>

    <div class="container">
        <div class="left-panel">
            <div class="header-top">
                <div class="stock-logo">{{ stock.stock_name[0] }}</div>
                <div class="action-buttons">
                    <button id="watchlistBtn"><i class="bi bi-bookmark"></i><span id="watchlistText">Watchlist</span>s</button>
                </div>
            </div>

            <div class="price-section">
                <h1 id="stockName">{{ stock.stock_name }}</h1>
                <div class="price-row">
                    <span class="current_price" id="currentPrice">₹--</span>
                    <span class="price_change" id="priceChange">--</span>
                </div>
            </div>

            <div class="chart-placeholder">
                Graph Space (Interactive Chart Area)
            </div>

            <div class="time-filters">
                <button>NSE</button>
                <button style="background: #eee;">1D</button>
                <button>1W</button>
                <button>1M</button>
                <button>3M</button>
                <button>1Y</button>
                <button>All</button>
            </div>
        </div>

        <div class="right-panel">
            <div class="order-header">
                <h2 id="orderStockName">{{ stock.stock_name }}</h2>
                <p class="exchange-info" id="exchange-id"></p>
                <p class="exchange-info" style="margin-top:6px;">
                    Holding: <span id="holdingQty">0</span> shares
                </p>
            </div>

            <div class="tabs">
                <div class="tab active" id="buy-tab">BUY</div>
                <div class="tab" id="sell-tab">SELL</div>
            </div>

            <div class="order-type-chips">
                <div class="chip active">Delivery</div>
                <div class="chip">MTF 2.86x</div>
            </div>

            <div class="input-group">
                <label>Qty <b>BSE</b> ▾</label>
                <input id="qty" type="number" value="1">
            </div>

            <div class="input-group">
                <label id="priceTypeToggle" style="cursor:pointer;">Price <b id="orderTypeText">Limit</b> ▾</label>
                <input id="price" type="text">
            </div>

            <div class="footer-info">
                <div class="info-row">
                    <span>Balance: ₹0</span>
                    <span>Approx req.: ₹0</span>
                </div>
                <button class="buy-btn" id="submitOrderBtn">Buy</button>
            </div>
        </div>
    </div>

    <div class="indicators-wrapper">
        <div class="gauge-container">
            <div class="gauge-title">Technical Indicator (RSI)</div>
            <svg class="gauge-svg" viewBox="0 0 320 180" preserveAspectRatio="xMidYMid meet">
                <!-- Gradient definitions for smooth color zones -->
                <defs>
                    <linearGradient id="arcGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#c0392b;stop-opacity:1" />
                        <stop offset="20%" style="stop-color:#e74c3c;stop-opacity:1" />
                        <stop offset="40%" style="stop-color:#f39c12;stop-opacity:1" />
                        <stop offset="50%" style="stop-color:#7f8c8d;stop-opacity:1" />
                        <stop offset="60%" style="stop-color:#27ae60;stop-opacity:1" />
                        <stop offset="80%" style="stop-color:#2ecc71;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#16a085;stop-opacity:1" />
                    </linearGradient>
                </defs>

                <!-- Semi-circular arc (180° from 180° to 0°) -->
                <path class="gauge-arc" d="M 20 160 A 140 140 0 0 1 300 160" fill="none" stroke="url(#arcGradient)"
                    stroke-width="3" stroke-linecap="round" />

                <!-- Needle group (rotates around center) -->
                <g class="needle-group-rsi">
                    <!-- Needle line -->
                    <line class="needle-line" x1="160" y1="160" x2="160" y2="40" stroke="black" stroke-width="2"
                        stroke-linecap="round" />

                    <!-- Center dot -->
                    <circle class="center-dot" cx="160" cy="160" r="5" fill="black" />
                </g>
            </svg>

            <div class="label-container">
                <div class="label-text" id="label-rsi">Neutral</div>
            </div>
        </div>

        <div class="gauge-container">
            <div class="gauge-title">Technical Indicator (EMA 20)</div>
            <svg class="gauge-svg" viewBox="0 0 320 180" preserveAspectRatio="xMidYMid meet">
                <!-- Gradient definitions for smooth color zones -->
                <defs>
                    <linearGradient id="arcGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#c0392b;stop-opacity:1" />
                        <stop offset="20%" style="stop-color:#e74c3c;stop-opacity:1" />
                        <stop offset="40%" style="stop-color:#f39c12;stop-opacity:1" />
                        <stop offset="50%" style="stop-color:#7f8c8d;stop-opacity:1" />
                        <stop offset="60%" style="stop-color:#27ae60;stop-opacity:1" />
                        <stop offset="80%" style="stop-color:#2ecc71;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#16a085;stop-opacity:1" />
                    </linearGradient>
                </defs>

                <!-- Semi-circular arc (180° from 180° to 0°) -->
                <path class="gauge-arc" d="M 20 160 A 140 140 0 0 1 300 160" fill="none" stroke="url(#arcGradient)"
                    stroke-width="3" stroke-linecap="round" />

                <!-- Needle group (rotates around center) -->
                <g class="needle-group-ema20">
                    <!-- Needle line -->
                    <line class="needle-line" x1="160" y1="160" x2="160" y2="40" stroke="black" stroke-width="2"
                        stroke-linecap="round" />

                    <!-- Center dot -->
                    <circle class="center-dot" cx="160" cy="160" r="5" fill="black" />
                </g>
            </svg>

            <div class="label-container">
                <div class="label-text" id="label-ema20">Neutral</div>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script src="/static/js/stock.js"></script>

</body>

</html>