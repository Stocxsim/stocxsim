{% extends "base.html" %}
{% block title %}Funds | Stocxsim{% endblock %}

{% block css %}
<link rel="stylesheet" href="/static/css/funds.css">
{% endblock %}

{% block content %}
<div class="container funds-page-container">
    <div class="row g-4">

        <!-- LEFT -->
        <div class="col-md-7">
            <div class="card p-4 text-center">
                <h6 class="text-muted">Stocks balance</h6>
                <h2 id="stocksBalance" class="text-heading">₹{{ user.balance }}</h2>
                <hr>

                <div class="d-flex justify-content-between">
                    <span>Cash</span>
                    <strong id="cashBalance" class="text-heading">₹{{ user.balance }}</strong>
                </div>
            </div>

            <div class="card mt-3 p-3 d-flex justify-content-between flex-row align-items-center" id="transactions" onclick="showTransaction()">
                <span>All transactions</span>
                <i class="bi bi-chevron-right"></i>
            </div>
        </div>

        <!-- RIGHT -->
        <div class="col-md-5">
            <div class="card p-4">
                <div class="d-flex justify-content-between funds-tabs">
                    <span id="addTab" class="fund-tab active" onclick="switchTab('add')">
                        Add money
                    </span>
                    <span id="withdrawTab" class="fund-tab" onclick="switchTab('withdraw')">
                        Withdraw
                    </span>

                </div>
                <hr>
                <input 
  id="amountInput"
  type="number"
  class="form-control text-center fs-1 fw-bold border-0 amount-input"
  value="0"
  min="0"
>
<div class="d-flex justify-content-center gap-3 my-4">
  <button class="btn btn-light rounded-pill" onclick="addAmount(1000)">
    +₹1,000
  </button>
  <button class="btn btn-light rounded-pill" onclick="addAmount(5000)">
    +₹5,000
  </button>
  <button class="btn btn-light rounded-pill" onclick="addAmount(10000)">
    +₹10,000
  </button>
</div>



                <div id="infoBox" class="alert alert-light text-center">
                    Enter amount to add
                </div>
                <button id="actionBtn" class="btn btn-funds-action w-100 mt-4">
                    Add money
                </button>
            </div>
        </div>

    </div>
</div>
<!-- Transactions Modal -->
<div class="modal fade" id="transactionsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <h5 class="modal-title mb-0">Transactions</h5>
                    <div class="text-muted small">Recent activity for your account</div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
                <div id="transactionsError" class="alert alert-danger d-none" role="alert"></div>
                <div id="transactionsLoading" class="d-flex align-items-center gap-2 text-muted">
                    <div class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></div>
                    <span>Loading transactions…</span>
                </div>

                <div class="table-responsive mt-3">
                    <table class="table table-hover align-middle txn-table mb-0">
                        <thead class="table-light">
                            <tr>
                                <th style="width: 160px;">Date</th>
                                <th style="width: 140px;">Type</th>
                                <th>Asset</th>
                                <th class="text-end" style="width: 180px;">Amount</th>
                                <th class="text-center" style="width: 120px;">Status</th>
                            </tr>
                        </thead>
                        <tbody id="transactionBody"></tbody>
                    </table>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div id="orderBanner" class="order-banner"></div>


<div class="modal fade" id="breakdownModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered">
        <div class="modal-content border-0 shadow">
            <div class="modal-header border-0 pb-0">
                <h6 class="modal-title fw-bold text-muted" style="font-size: 0.9rem;">Charges</h6>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body py-3" style="font-size: 0.85rem;">
                <div class="d-flex justify-content-between mb-2">
                    <span class="text-muted">Exchange Transaction Charges</span>
                    <span id="brk_exchange">₹0.00</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                    <span class="text-muted">Ipft Charges</span>
                    <span id="brk_ipft">₹0.00</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                    <span class="text-muted">GST</span>
                    <span id="brk_gst">₹0.00</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                    <span class="text-muted">SEBI Turnover Charges</span>
                    <span id="brk_sebi">₹0.00</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                    <span class="text-muted">Securities Transaction Tax (STT)</span>
                    <span id="brk_stt">₹0.00</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                    <span class="text-muted">DP Charges</span>
                    <span id="brk_dp">₹0.00</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                    <span class="text-muted">Stamp Duty</span>
                    <span id="brk_stamp">₹0.00</span>
                </div>
                
                <hr class="my-3">
                
                <div class="mt-3">
                    <div class="d-flex justify-content-between mb-1">
                        <span>Gross Price</span> <span id="brk_gross_summary"></span>
                    </div>
                    <div class="d-flex justify-content-between mb-1">
                        <span>Total Charges</span> <span id="brk_total_charges" class="text-danger"></span>
                    </div>
                    <hr class="my-2">
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="fw-bold">Net Price</span>
                        <span id="breakdownNet" class="fw-bold fs-6 text-dark"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}


{% block js %}
<script src="/static/js/funds.js"></script>
{% endblock %}
